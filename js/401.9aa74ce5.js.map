{"version":3,"file":"js/401.9aa74ce5.js","mappings":"2MAGA,MACMA,EAAa,CAAEC,MAAO,iBACtBC,EAAa,CAAC,MAMpB,OAA4BC,EAAAA,EAAAA,IAAiB,CAC3CC,OAAQ,QACRC,KAAAA,CAAMC,GCCR,MAAMC,GAAYC,EAAAA,EAAAA,IAAwB,MACpCC,GAAeD,EAAAA,EAAAA,IAAI,GAEnBE,GAAaC,EAAAA,EAAAA,IAAS,IACtBC,GAAWJ,EAAAA,EAAAA,IAAsC,IACjDK,EAAcC,GAAmBC,IAC/BA,IACAH,EAASI,MAAMF,GAASC,E,EAGhCE,eAAeC,KACXC,EAAAA,EAAAA,MAAYC,MAAMC,IACdX,EAAMY,QAAQD,EAAKE,UAAU,IAC9BC,OAAM,KACLd,EAAMY,KAAK,CAAEG,SAAU,aAAcC,IAAK,IAC1ChB,EAAMY,KAAK,CAAEG,SAAU,aAAcC,IAAK,IAC1ChB,EAAMY,KAAK,CAAEG,SAAU,aAAcC,IAAK,GAAI,GAEtD,CACA,MAAMC,EAAgBC,IAClB,IAAKrB,EAAUS,MAAO,OACtB,MAAMa,EAASD,EAAEC,OACjB,IAAKtB,EAAUS,MAAMc,SAASD,GAAS,OACvCD,EAAEG,iBACEtB,EAAaO,OAASN,EAAMsB,OAAS,GACrCd,IAEJ,MAAMe,EAAgB1B,EAAUS,MAAMkB,iBAAiB,UACvD,IAAIC,EAAe,EACfC,EAAWC,IAEfJ,EAAcK,SAAQ,CAACC,EAASzB,KAC5B,IAAKP,EAAUS,MAAO,OACtB,MAAMwB,EAAOD,EAAQE,wBACfC,EAASC,KAAKC,IAAIJ,EAAKK,IAAMtC,EAAUS,MAAMyB,wBAAwBI,KACvEH,EAASN,IACTD,EAAerB,EACfsB,EAAWM,E,IAInB,IAAII,EAAWX,EAEXP,EAAEmB,OAAS,GAAKD,EAAWb,EAAcD,OAAS,EAClDc,IACOlB,EAAEmB,OAAS,GAAKD,EAAW,GAClCA,IAGJ,MAAME,EAAczC,EAAUS,MAAMiC,cAAc,UAAUH,KACxDE,IACAA,EAAYE,eAAe,CAAEC,SAAU,SAAUC,MAAO,UAAWC,OAAQ,UAC3E5C,EAAaO,MAAQ8B,E,EDY7B,OCRAQ,EAAAA,EAAAA,KAAU,KACNpC,IACIX,EAAUS,OACVT,EAAUS,MAAMuC,iBAAiB,QAAS5B,E,IDK3C,CAAC6B,EAAUC,MACRC,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAO,CAC/C1D,MAAO,sBACP2D,QAAS,YACTpD,IAAKD,EACLsD,QAASlC,GACR,EACDmC,EAAAA,EAAAA,GAAoB,MAAO9D,EAAY,GACpC0D,EAAAA,EAAAA,KAAW,IAAOC,EAAAA,EAAAA,IAAoBI,EAAAA,GAAW,MAAMC,EAAAA,EAAAA,IAAYtD,GAAO,CAACuD,EAAMnD,MACxE4C,EAAAA,EAAAA,OAAcC,EAAAA,EAAAA,IAAoB,MAAO,CAC/C1D,MAAO,QACPiE,IAAKpD,EACLqD,GAAI,SAAWrD,GACd,EACDsD,EAAAA,EAAAA,IAAaC,EAAAA,WAAW,CACtBC,MAAOL,EACPxC,SAAUwC,EAAKxC,SACf8C,SAAS,EACT/D,IAAKK,EAAWC,GAChBY,IAAKuC,EAAKvC,KACT,KAAM,EAAG,CAAC,QAAS,WAAY,SACjC,EAAGxB,MACJ,SAEL,KAEL,I,QElGA,MAAMsE,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://damao/./src/views/Friends/index.vue?0659","webpack://damao/./src/views/Friends/index.vue","webpack://damao/./src/views/Friends/index.vue?33e5"],"sourcesContent":["import { defineComponent as _defineComponent } from 'vue'\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createVNode as _createVNode, createElementVNode as _createElementVNode, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\"\n\nconst _withScopeId = n => (_pushScopeId(\"data-v-8eb35e30\"),n=n(),_popScopeId(),n)\nconst _hoisted_1 = { class: \"inner-wrapper\" }\nconst _hoisted_2 = [\"id\"]\n\nimport FeedModel from \"@/components/VideoWindow/index.vue\";\nimport { ref, onMounted, reactive } from 'vue';\nimport { getVideos } from \"@/apis/video\";\n\nexport default /*#__PURE__*/_defineComponent({\n  __name: 'index',\n  setup(__props) {\n\nconst container = ref<HTMLElement | null>(null);\nconst currentIndex = ref(0);\n\nconst items: any = reactive([]);\nconst testRefs = ref<InstanceType<typeof FeedModel>[]>([]);\nconst setTestRef = (index: number) => (el: InstanceType<typeof FeedModel> | null) => {\n    if (el) {\n        testRefs.value[index] = el;\n    }\n};\nasync function loadRecommend() {\n    getVideos().then((data: any) => {\n        items.push(...data.feed_list)\n    }).catch(() => {\n        items.push({ videoSrc: \"j (11).mp4\", vid: 1 })\n        items.push({ videoSrc: \"j (12).mp4\", vid: 1 })\n        items.push({ videoSrc: \"j (13).mp4\", vid: 1 })\n    })\n}\nconst handleScroll = (e: WheelEvent) => {\n    if (!container.value) return;\n    const target = e.target as HTMLElement;\n    if (!container.value.contains(target)) return;\n    e.preventDefault();\n    if (currentIndex.value >= items.length - 2) {\n        loadRecommend()\n    }\n    const innerElements = container.value.querySelectorAll('.inner');\n    let closestIndex = 0;\n    let distance = Infinity;\n\n    innerElements.forEach((element, index) => {\n        if (!container.value) return;\n        const rect = element.getBoundingClientRect();\n        const offset = Math.abs(rect.top - container.value.getBoundingClientRect().top);\n        if (offset < distance) {\n            closestIndex = index;\n            distance = offset;\n        }\n    });\n\n    let newIndex = closestIndex;\n\n    if (e.deltaY > 0 && newIndex < innerElements.length - 1) {\n        newIndex++;\n    } else if (e.deltaY < 0 && newIndex > 0) {\n        newIndex--;\n    }\n\n    const targetInner = container.value.querySelector(`#inner_${newIndex}`);\n    if (targetInner) {\n        targetInner.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });\n        currentIndex.value = newIndex;\n    }\n};\n\nonMounted(() => {\n    loadRecommend()\n    if (container.value) {\n        container.value.addEventListener('wheel', handleScroll);\n    }\n});\n\nreturn (_ctx: any,_cache: any) => {\n  return (_openBlock(), _createElementBlock(\"div\", {\n    class: \"recommend-container\",\n    ref_key: \"container\",\n    ref: container,\n    onWheel: handleScroll\n  }, [\n    _createElementVNode(\"div\", _hoisted_1, [\n      (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(items, (item, index) => {\n        return (_openBlock(), _createElementBlock(\"div\", {\n          class: \"inner\",\n          key: index,\n          id: 'inner_' + index\n        }, [\n          _createVNode(FeedModel, {\n            modal: item,\n            videoSrc: item.videoSrc,\n            ref_for: true,\n            ref: setTestRef(index),\n            vid: item.vid\n          }, null, 8, [\"modal\", \"videoSrc\", \"vid\"])\n        ], 8, _hoisted_2))\n      }), 128))\n    ])\n  ], 544))\n}\n}\n\n})","<template>\n    <div class=\"recommend-container\" ref=\"container\" @wheel=\"handleScroll\">\n        <div class=\"inner-wrapper\">\n            <div class=\"inner\" v-for=\"(item, index) in items\" :key=\"index\" :id=\"'inner_' + index\">\n                <FeedModel :modal=\"item\" :videoSrc=\"item.videoSrc\" :ref=\"setTestRef(index)\" :vid=\"item.vid\"></FeedModel>\n            </div>\n        </div>\n    </div>\n</template>\n  \n<script setup lang=\"ts\">\nimport FeedModel from \"@/components/VideoWindow/index.vue\";\nimport { ref, onMounted, reactive } from 'vue';\nimport { getVideos } from \"@/apis/video\";\nconst container = ref<HTMLElement | null>(null);\nconst currentIndex = ref(0);\n\nconst items: any = reactive([]);\nconst testRefs = ref<InstanceType<typeof FeedModel>[]>([]);\nconst setTestRef = (index: number) => (el: InstanceType<typeof FeedModel> | null) => {\n    if (el) {\n        testRefs.value[index] = el;\n    }\n};\nasync function loadRecommend() {\n    getVideos().then((data: any) => {\n        items.push(...data.feed_list)\n    }).catch(() => {\n        items.push({ videoSrc: \"j (11).mp4\", vid: 1 })\n        items.push({ videoSrc: \"j (12).mp4\", vid: 1 })\n        items.push({ videoSrc: \"j (13).mp4\", vid: 1 })\n    })\n}\nconst handleScroll = (e: WheelEvent) => {\n    if (!container.value) return;\n    const target = e.target as HTMLElement;\n    if (!container.value.contains(target)) return;\n    e.preventDefault();\n    if (currentIndex.value >= items.length - 2) {\n        loadRecommend()\n    }\n    const innerElements = container.value.querySelectorAll('.inner');\n    let closestIndex = 0;\n    let distance = Infinity;\n\n    innerElements.forEach((element, index) => {\n        if (!container.value) return;\n        const rect = element.getBoundingClientRect();\n        const offset = Math.abs(rect.top - container.value.getBoundingClientRect().top);\n        if (offset < distance) {\n            closestIndex = index;\n            distance = offset;\n        }\n    });\n\n    let newIndex = closestIndex;\n\n    if (e.deltaY > 0 && newIndex < innerElements.length - 1) {\n        newIndex++;\n    } else if (e.deltaY < 0 && newIndex > 0) {\n        newIndex--;\n    }\n\n    const targetInner = container.value.querySelector(`#inner_${newIndex}`);\n    if (targetInner) {\n        targetInner.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'start' });\n        currentIndex.value = newIndex;\n    }\n};\n\nonMounted(() => {\n    loadRecommend()\n    if (container.value) {\n        container.value.addEventListener('wheel', handleScroll);\n    }\n});\n</script>\n  \n<style scoped>\n.recommend-container {\n    height: 100%;\n    position: relative;\n    /* 固定容器的位置 */\n    top: 0;\n    left: 0;\n    z-index: 0;\n    overflow: hidden;\n    /* 隐藏溢出内容 */\n    width: 100%;\n    background-color: rgb(22, 24, 35);\n    /* 这里是过渡时间，你可以根据需要调整 */\n}\n\n.inner-wrapper {\n    height: 100%;\n    width: 100%;\n    height: calc(100% - 12px);\n    width: 98%;\n    /* overflow-y: auto; */\n    /* 允许容器内部滚动 */\n}\n\n.inner {\n    /* margin-bottom: 100px; */\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    margin-bottom: 20px;\n}\n</style>\n  ","import script from \"./index.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=8eb35e30&scoped=true&lang=css\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-8eb35e30\"]])\n\nexport default __exports__"],"names":["_hoisted_1","class","_hoisted_2","_defineComponent","__name","setup","__props","container","ref","currentIndex","items","reactive","testRefs","setTestRef","index","el","value","async","loadRecommend","getVideos","then","data","push","feed_list","catch","videoSrc","vid","handleScroll","e","target","contains","preventDefault","length","innerElements","querySelectorAll","closestIndex","distance","Infinity","forEach","element","rect","getBoundingClientRect","offset","Math","abs","top","newIndex","deltaY","targetInner","querySelector","scrollIntoView","behavior","block","inline","onMounted","addEventListener","_ctx","_cache","_openBlock","_createElementBlock","ref_key","onWheel","_createElementVNode","_Fragment","_renderList","item","key","id","_createVNode","FeedModel","modal","ref_for","__exports__"],"sourceRoot":""}